<ul class="menu-bar">
  <li class="menu-item" tabindex="0">{{ page.app_name | default: "$AppName" }}
    <ul class="menu">
      <li class="menu-item"><button id="return-to-parent-menu-item">Return to <span id="parent-page-name">Parent</span></button></li>
    </ul>
  </li>
  <li class="menu-item" tabindex="0">File
    <ul class="menu">
      <li class="menu-item"><button id="about-menu-item">About</button></li>
      <li class="menu-item divider"></li>
      <li class="menu-item"><button id="close-window-menu-item">Close Window</button></li>
    </ul>
  </li>
  <li class="menu-item" tabindex="0">Navigate
    <ul class="menu">
      <li class="menu-item"><a href="{{ '/' | relative_url }}">Home</a></li>
      <li class="menu-item"><a href="{{ '/projects' | relative_url }}">Projects</a></li>
      <li class="menu-item"><a href="{{ '/blog' | relative_url }}">Blog</a></li>
      <li class="menu-item"><a href="{{ '/gallery' | relative_url }}">Gallery</a></li>
      <li class="menu-item divider"></li>
      <li class="menu-item"><a href="{{ '/resume' | relative_url }}">Resume</a></li>
    </ul>
  </li>
  <li class="menu-item" tabindex="0">View
    <ul class="menu">
      <li class="menu-item"><button id="theme-monochrome-light">Monochrome Light</button></li>
      <li class="menu-item"><button id="theme-monochrome-dark">Monochrome Dark</button></li>
      <li class="menu-item divider"></li>
      <li class="menu-item"><button id="theme-latte-pink">Catppuccin Latte</button></li>
      <li class="menu-item"><button id="theme-mocha-pink">Catppuccin Mocha</button></li>
      <li class="menu-item divider"></li>
      <li class="menu-item"><button id="font-atkinson">Atkinson Hyperlegible</button></li>
    </ul>
  </li>
  <li class="menu-item" tabindex="0">Help
    <ul class="menu">
      <li class="menu-item"><button id="acknowledgements-menu-item">Acknowledgements</button></li>
      <li class="menu-item divider"></li>
      <li class="menu-item"><a href="https://github.com/abbyfluoroethane/abbyfluoroethane.github.io/issues" target="_blank">Report a Bug</a></li>
      <li class="menu-item"><a href="https://github.com/abbyfluoroethane/abbyfluoroethane.github.io" target="_blank">View Source</a></li>
    </ul>
  </li>
  <li class="menu-item" aria-haspopup="false" style="flex: 1; background: var(--secondary);"></li>
  <li class="menu-item" aria-haspopup="false"><span id="clock">--:--</span></li>
</ul>

<script>
  // Clock update function
  function updateClock() {
    const now = new Date();
    const hours = now.getHours() % 12 || 12;
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
    document.getElementById('clock').textContent = `${hours}:${minutes} ${ampm}`;
  }
  updateClock();
  setInterval(updateClock, 1000);

  // Click outside menus to close (blur active element)
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.menu-bar')) {
      document.activeElement.blur();
    }
  });

  // About window functionality
  function showAboutWindow() {
    const overlay = document.getElementById('about-overlay');
    if (overlay) {
      overlay.classList.remove('hidden');
    }
  }

  function hideAboutWindow() {
    const overlay = document.getElementById('about-overlay');
    if (overlay) {
      overlay.classList.add('hidden');
    }
  }

  // Acknowledgements window functionality
  function showAcknowledgementsWindow() {
    const overlay = document.getElementById('acknowledgements-overlay');
    if (overlay) {
      overlay.classList.remove('hidden');
    }
  }

  function hideAcknowledgementsWindow() {
    const overlay = document.getElementById('acknowledgements-overlay');
    if (overlay) {
      overlay.classList.add('hidden');
    }
  }

  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', function() {
    // About menu item - show About window
    const aboutMenuItem = document.getElementById('about-menu-item');
    if (aboutMenuItem) {
      aboutMenuItem.addEventListener('click', function(e) {
        e.preventDefault();
        document.activeElement.blur();
        showAboutWindow();
      });
    }

    // Acknowledgements menu item - show Acknowledgements window
    const acknowledgementsMenuItem = document.getElementById('acknowledgements-menu-item');
    if (acknowledgementsMenuItem) {
      acknowledgementsMenuItem.addEventListener('click', function(e) {
        e.preventDefault();
        document.activeElement.blur();
        showAcknowledgementsWindow();
      });
    }

    // Close Window menu item - go to home
    const closeWindowMenuItem = document.getElementById('close-window-menu-item');
    if (closeWindowMenuItem) {
      const currentPath = window.location.pathname;
      const homePath = '{{ "/" | relative_url }}';
      const isHomePage = currentPath === homePath || currentPath === homePath + 'index.html';

      if (isHomePage) {
        closeWindowMenuItem.disabled = true;
      } else {
        closeWindowMenuItem.addEventListener('click', function(e) {
          e.preventDefault();
          window.location.href = homePath;
        });
      }
    }

    // Return to Parent menu item - navigate to parent page
    const returnToParentMenuItem = document.getElementById('return-to-parent-menu-item');
    const parentPageNameSpan = document.getElementById('parent-page-name');
    if (returnToParentMenuItem && parentPageNameSpan) {
      const currentPath = window.location.pathname;
      const projectsPath = '{{ "/projects" | relative_url }}';
      const blogPath = '{{ "/blog" | relative_url }}';
      const homePath = '{{ "/" | relative_url }}';

      let parentPath = null;
      let parentName = 'Parent';
      let isOnParentPage = false;

      if (currentPath === projectsPath || currentPath === projectsPath + '/' || currentPath === projectsPath + '/index.html') {
        isOnParentPage = true;
        parentName = 'Projects';
      } else if (currentPath === blogPath || currentPath === blogPath + '/' || currentPath === blogPath + '/index.html') {
        isOnParentPage = true;
        parentName = 'Blog';
      } else if (currentPath === homePath || currentPath === homePath + 'index.html') {
        isOnParentPage = true;
        parentName = 'Home';
      } else {
        if (currentPath.includes('/projects/') || currentPath.includes('/_projects/')) {
          parentPath = projectsPath;
          parentName = 'Projects';
        } else if (currentPath.includes('/blog/') || currentPath.includes('/_posts/') || currentPath.match(/\/\d{4}\/\d{2}\/\d{2}\//)) {
          parentPath = blogPath;
          parentName = 'Blog';
        } else {
          parentPath = homePath;
          parentName = 'Home';
        }
      }

      parentPageNameSpan.textContent = parentName;

      if (isOnParentPage || !parentPath) {
        returnToParentMenuItem.disabled = true;
      } else {
        returnToParentMenuItem.addEventListener('click', function(e) {
          e.preventDefault();
          window.location.href = parentPath;
        });
      }
    }

    // About close button
    const aboutClose = document.getElementById('about-close');
    if (aboutClose) {
      aboutClose.addEventListener('click', hideAboutWindow);
    }

    // Acknowledgements close button
    const acknowledgementsClose = document.getElementById('acknowledgements-close');
    if (acknowledgementsClose) {
      acknowledgementsClose.addEventListener('click', hideAcknowledgementsWindow);
    }

    // Click overlay to close About
    const aboutOverlay = document.getElementById('about-overlay');
    if (aboutOverlay) {
      aboutOverlay.addEventListener('click', function(e) {
        if (e.target === aboutOverlay) {
          hideAboutWindow();
        }
      });
    }

    // Click overlay to close Acknowledgements
    const acknowledgementsOverlay = document.getElementById('acknowledgements-overlay');
    if (acknowledgementsOverlay) {
      acknowledgementsOverlay.addEventListener('click', function(e) {
        if (e.target === acknowledgementsOverlay) {
          hideAcknowledgementsWindow();
        }
      });
    }

    // --- View menu: Theme switching ---
    var themeButtons = {
      'monochrome-light': document.getElementById('theme-monochrome-light'),
      'monochrome-dark': document.getElementById('theme-monochrome-dark'),
      'latte-pink': document.getElementById('theme-latte-pink'),
      'mocha-pink': document.getElementById('theme-mocha-pink')
    };

    var themeLabels = {
      'monochrome-light': 'Monochrome Light',
      'monochrome-dark': 'Monochrome Dark',
      'latte-pink': 'Catppuccin Latte',
      'mocha-pink': 'Catppuccin Mocha'
    };

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      updateThemeCheckmarks(theme);

      var themeColors = {
        'monochrome-light': '#ffffff',
        'monochrome-dark': '#1a1a1a',
        'latte-pink': '#eff1f5',
        'mocha-pink': '#1e1e2e'
      };
      var meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.setAttribute('content', themeColors[theme] || '#ffffff');
    }

    function updateThemeCheckmarks(theme) {
      Object.keys(themeButtons).forEach(function(key) {
        var btn = themeButtons[key];
        if (btn) {
          btn.textContent = (key === theme ? '\u2713 ' : '') + themeLabels[key];
        }
      });
    }

    Object.keys(themeButtons).forEach(function(key) {
      var btn = themeButtons[key];
      if (btn) {
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          setTheme(key);
          document.activeElement.blur();
        });
      }
    });

    // --- View menu: Font toggle ---
    var fontButton = document.getElementById('font-atkinson');

    function setFont(font) {
      document.documentElement.setAttribute('data-font', font);
      localStorage.setItem('font', font);
      updateFontCheckmark(font);
    }

    function updateFontCheckmark(font) {
      if (fontButton) {
        fontButton.textContent = (font === 'atkinson' ? '\u2713 ' : '') + 'Atkinson Hyperlegible';
      }
    }

    if (fontButton) {
      fontButton.addEventListener('click', function(e) {
        e.preventDefault();
        var current = document.documentElement.getAttribute('data-font') || 'default';
        setFont(current === 'atkinson' ? 'default' : 'atkinson');
        document.activeElement.blur();
      });
    }

    // Initialize checkmarks from current state
    var currentTheme = document.documentElement.getAttribute('data-theme') || 'monochrome-light';
    var currentFont = document.documentElement.getAttribute('data-font') || 'default';
    updateThemeCheckmarks(currentTheme);
    updateFontCheckmark(currentFont);
  });
</script>
